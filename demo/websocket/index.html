<!DOCTYPE html>
<html>
<head>
</head>
<body>
<input id="message" type="text" value="hello" />
<input id="connect" type="button" value="Connect" onclick="Client.connect()" />
<input id="send" type="button" value="Send" onclick="Client.send()" disabled="disabled" />
<div id="output"></div>
<script type="text/javascript">

var Client = {
    url: "ws://localhost:12345/phpsocket/demo/websocket/server.php",
    socket: null,
    
    createSocket: function() {
        var ws = null;
        if (window.MozWebSocket) {
            window.WebSocket = window.MozWebSocket;
        }
        if (window.WebSocket) {
           ws = new WebSocket(Client.url);
           ws.onopen = function() {
                var btn = $('connect');
                btn.value = "Disconnect";
                btn.onclick = Client.disconnect;
                $('send').disabled = false;
                clear();
                log("Connected!");
            }
            ws.onmessage = function (evt) {
                log("Received: " + evt.data);
                if (evt.data == 'ping') {
                    this.send('pong');
                    log("Sent: pong");
                }
            };
            ws.onclose = function() {
                var btn = $('connect');
                btn.value = "Connect";
                btn.onclick = Client.connect;
                $('send').disabled = true;
                log("Connection is closed!");
            }
            ws.onerror = function(evt) {
                log("Error");
            }
        }
        return ws;
    },
    
    connect: function() {
        Client.socket = Client.createSocket();
        log("Connecting...");
        if (!Client.socket) {
            log("WebSocket not supported");
        }
    },
    
    send: function() {
        if (Client.socket) {
            var message = $('message').value;
            Client.socket.send(message);
        }
    },
    
    disconnect: function() {
        if (Client.socket) {
            Client.socket.close();
        }
    }
}

function $(id) {
    return document.getElementById(id);
}

function log(message) {
    $('output').innerHTML += "<p>" + message + "</p>";
}

function clear() {
    $('output').innerHTML = "";
}
</script>
</body>
</html>
